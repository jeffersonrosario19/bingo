<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bing√£o de S√£o Francisco</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #7c6746, #e2d8c3);
      color: #fff;
      padding: 1rem;
      padding-bottom: 100px;
    }
    h1 {line-height: 1.2; text-align: center; font-size: 2rem; margin-bottom: 0.25rem; }
    .logo { display: block; margin: 0 auto 1rem; max-width: 80px; }
    .subtitulo { text-align: center; font-size: 1rem; margin-bottom: 0.75rem; color: #fff8e1; }
    .frase-final { text-align: center; margin-top: 1rem; font-size: 0.9rem; font-style: italic; color: #ffe; }
    .endereco { text-align: center; margin-top: 0.5rem; font-size: 0.9rem; }
    .sequencia { margin-bottom: 1.5rem; }
    .sequencia h2 {
      background: #fff8e1;
      color: #6d4c41;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      text-align: center;
    }
    .cards-scroll {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 0.75rem;
      padding: 0.75rem 0;
      scroll-behavior: smooth;
      position: relative;
    }
    .card {
      flex: 0 0 160px;
      background: #fff;
      color: #333;
      border-radius: 10px;
      padding: 10px;
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    .card.disabled {
      border: 1px solid red;
      background: #f5f5f5;
      pointer-events: none;
    }
    .cards-scroll::after {
  content: "‚û°";
  position: absolute;
  right: 5px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2rem;
  color: rgba(0,0,0,0.4);
  pointer-events: none;
  animation: pisca 1s infinite alternate;
}

@keyframes pisca {
  from { opacity: 0.3; }
  to { opacity: 1; }
}
    .card input[type="checkbox"] {
      position: absolute;
      top: 10px;
      left: 10px;
      transform: scale(1.2);
    }
    .numero-cartela {
      position: absolute;
      top: 10px;
      left: 40px;
      background: #ccc;
      padding: 2px 6px;
      font-size: 0.9rem;
      border-radius: 4px;
    }
    .card img {
      width: 100%;
      height: 140px;
      object-fit: contain;
      margin-top: 8px;
      background: #f0f0f0;
      border-radius: 6px;
      cursor: pointer;
    }
    .card img.erro {
      opacity: 0.6;
    }
    .status {
      font-weight: bold;
      margin: 8px 0;
      text-transform: capitalize;
    }
    .livre { color: #2e7d32; }
    .reservada { color: #ef6c00; }
    .vendida { color: #c62828; }
    .btn-ver {
      background: #6d4c41;
      color: #fff;
      border: none;
      padding: 6px;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #modalImagem {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    #modalImagem img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
    }
    #botaoFixo {
      position: fixed;
      bottom: 0; left: 0; width: 100%;
      background: #4e342e;
      color: white;
      font-size: 1rem;
      padding: 1rem;
      border: none;
      cursor: pointer;
      display: none;
      z-index: 1000;
    }
    #popup-bg {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }
    #popup {
      background: #fff;
      color: #333;
      max-width: 400px;
      width: 100%;
      padding: 1.5rem;
      border-radius: 10px;
    }
    #popup input {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    .btn-comprar {
      width: 100%;
      background: #2c9ab7;
      color: white;
      border: none;
      padding: 0.75rem;
      margin-top: 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    @media (max-width: 500px) {
      .card { flex: 0 0 120px; }
      .card img { height: 100px; }
    }
    .scroll-hint {
  font-size: 0.9rem;
  color: #555;
  text-align: center;
  margin: 10px 0;
  font-style: italic;
}

  </style>
</head>
<body>

  <img src="assets/logo.png" class="logo" alt="Logo do Bing√£o" />
  <h1>Bing√£o da Comunidade S√£o Francisco de Assis - 04/10/2025</h1>
  <p class="subtitulo">Participe do nosso Bing√£o e ajude a fortalecer a miss√£o da nossa igreja!</p>
  <p class="scroll-hint">‚û°Ô∏è Arraste para o lado para ver mais cartelas</p>
  <div id="cartelas"></div>
  
  <p class="frase-final">üôè Toda arrecada√ß√£o ser√° destinada a melhorias estruturais da igreja e benfeitorias mission√°rias da Comunidade.</p>
  <p class="endereco">üìç Vila de Brasileiro ‚Äì Santar√©m Novo</p>

  <button id="botaoFixo" onclick="abrirFormulario()">üõí Comprar (0 cartelas)</button>

  <div id="modalImagem" onclick="fecharModal()">
    <img id="imagemReal" src="" alt="Cartela ampliada" />
  </div>

  <div id="popup-bg">
    <div id="popup">
      <h3>Finalizar Compra</h3>
      <ul id="listaSelecionadas"></ul>
      <input id="nome" placeholder="Nome completo" />
      <input id="endereco" placeholder="Endere√ßo" />
      <input id="cidade" placeholder="Cidade" />
      <input id="whatsapp" placeholder="WhatsApp com DDD" />
      <button onclick="fecharFormulario()" style="margin-top: 0.5rem; background: #aaa; color: white; border: none; padding: 0.6rem; border-radius: 6px; width: 100%;">Voltar</button>
      <button class="btn-comprar" onclick="enviarCompra()">Enviar pelo WhatsApp</button>
    </div>
  </div>

  <script>
  let cartelas = [];
  const cartelasPorSequencia = 10;
  let selecionadas = new Set();

  const container = document.getElementById('cartelas');
  const botaoFixo = document.getElementById('botaoFixo');
  const popupBg = document.getElementById('popup-bg');
  const listaSelecionadas = document.getElementById('listaSelecionadas');
  const imagemReal = document.getElementById('imagemReal');
  const modalImagem = document.getElementById('modalImagem');

  const API_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQx4HDIZRkl-0AzPllWIN3rqaN0t9jQP9uMw7Cuk1wV1lfWe-jiy5zoXUIWtVBV7neWKKFrEf7WyPN6/pub?output=csv';
  const IMG_FALLBACK = 'assets/erro.jpg';

  async function carregarCartelas() {
    try {
      const response = await fetch(API_CSV);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      const text = await response.text();

      const linhas = text.trim().split(/\r?\n/);
      const dados = linhas.slice(1); // pula cabe√ßalho ‚Äúnumero,status‚Äù

      cartelas = dados.map(linha => {
        const [numeroRaw, statusRaw] = linha.split(/[;,]/).map(s => s.trim());
        const id = parseInt(numeroRaw, 10);
        const status = statusRaw ? statusRaw.toLowerCase() : 'livre';
        return { id, status };
      }).filter(c => !isNaN(c.id));

      cartelas.sort((a, b) => a.id - b.id);

      const totalSequencias = Math.ceil(cartelas.length / cartelasPorSequencia);
      for (let i = 0; i < totalSequencias; i++) {
        const grupo = cartelas.slice(i * cartelasPorSequencia, (i + 1) * cartelasPorSequencia);
        criarSequenciaCards(grupo);
      }
    } catch (erro) {
      console.error('Erro ao carregar o CSV:', erro);
      container.innerHTML = `<p style="color:red; text-align:center;">Erro ao carregar os dados das cartelas.</p>`;
    }
  }

  function criarSequenciaCards(cartelasDoGrupo) {
    const seqDiv = document.createElement('div');
    seqDiv.className = 'sequencia';

    const h2 = document.createElement('h2');
    const ini = cartelasDoGrupo[0].id;
    const fim = cartelasDoGrupo[cartelasDoGrupo.length - 1].id;
    h2.textContent = `Cartelas de ${ini} a ${fim}`;

    const cardsDiv = document.createElement('div');
    cardsDiv.className = 'cards-scroll';
    cardsDiv.style.display = 'flex'; // sempre vis√≠vel

    cartelasDoGrupo.forEach(c => {
      const card = document.createElement('div');
      card.className = 'card';
      if (c.status !== 'livre') card.classList.add('disabled');

      // Checkbox
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.id = `chk-${c.id}`;
      checkbox.checked = selecionadas.has(c.id);
      checkbox.disabled = c.status !== 'livre';
      checkbox.onclick = e => {
        e.stopPropagation();
        if (checkbox.checked) selecionadas.add(c.id);
        else selecionadas.delete(c.id);
        atualizarBotaoFixo();
        atualizarListaSelecionadas();
      };
      card.appendChild(checkbox);

      // N√∫mero
      const numeroEl = document.createElement('div');
      numeroEl.className = 'numero-cartela';
      numeroEl.textContent = c.id;
      card.appendChild(numeroEl);

      // Imagem
      const img = document.createElement('img');
      img.alt = `Cartela ${c.id}`;
      const caminho = `assets/${c.id}.jpg`;
      img.src = caminho;
      img.onerror = () => { img.src = IMG_FALLBACK; };
      img.onclick = () => abrirModal(img.src, c.id);
      card.appendChild(img);

      // Status
      const statusEl = document.createElement('div');
      statusEl.className = 'status ' + c.status;
      statusEl.textContent = c.status.charAt(0).toUpperCase() + c.status.slice(1);
      card.appendChild(statusEl);

      // Bot√£o ver
      const btnVer = document.createElement('button');
      btnVer.className = 'btn-ver';
      btnVer.textContent = 'Ver cartela';
      btnVer.onclick = e => {
        e.stopPropagation();
        abrirModal(img.src, c.id);
      };
      card.appendChild(btnVer);

      cardsDiv.appendChild(card);
    });

    seqDiv.appendChild(h2);
    seqDiv.appendChild(cardsDiv);
    container.appendChild(seqDiv);
  }

  function atualizarBotaoFixo() {
    const qtd = selecionadas.size;
    if (qtd > 0) {
      botaoFixo.style.display = 'block';
      botaoFixo.textContent = `üõí Comprar (${qtd} cartela${qtd > 1 ? 's' : ''})`;
    } else {
      botaoFixo.style.display = 'none';
    }
  }

  function atualizarListaSelecionadas() {
    listaSelecionadas.innerHTML = '';
    Array.from(selecionadas).sort((a, b) => a - b).forEach(id => {
      const li = document.createElement('li');
      li.textContent = `Cartela ${id}`;
      listaSelecionadas.appendChild(li);
    });
  }

  function abrirModal(imagem, id) {
    imagemReal.src = imagem;
    modalImagem.style.display = 'flex';
  }

  function fecharModal() {
    modalImagem.style.display = 'none';
    imagemReal.src = '';
  }

  function abrirFormulario() {
    if (selecionadas.size === 0) return;
    popupBg.style.display = 'flex';
  }

  function fecharFormulario() {
    popupBg.style.display = 'none';
  }

  function enviarCompra() {
    const nome = document.getElementById('nome').value.trim();
    const endereco = document.getElementById('endereco').value.trim();
    const cidade = document.getElementById('cidade').value.trim();
    let whatsappCliente = document.getElementById('whatsapp').value.trim();

    if (!nome || !endereco || !cidade || !whatsappCliente) {
      alert('Por favor, preencha todos os campos.');
      return;
    }

    whatsappCliente = whatsappCliente.replace(/\D/g, '');
    if (whatsappCliente.length < 10 || whatsappCliente.length > 11) {
      alert('Digite um n√∫mero de WhatsApp v√°lido com DDD (ex: 91980000000).');
      return;
    }

    const cartelasList = Array.from(selecionadas)
      .sort((a, b) => a - b)
      .map(id => `Cartela ${id}`)
      .join(', ');

    const numeroDestino = "5591987577521";

    const mensagem = `Ol√°! Gostaria de comprar as seguintes cartelas:\n${cartelasList}\n\n` +
      `Nome: ${nome}\nEndere√ßo: ${endereco}\nCidade: ${cidade}\nWhatsApp: ${whatsappCliente}`;

    const urlWhatsApp = `https://wa.me/${numeroDestino}?text=${encodeURIComponent(mensagem)}`;

    window.open(urlWhatsApp, '_blank');
    fecharFormulario();
  }

  carregarCartelas();
  </script>
</body>
</html>
